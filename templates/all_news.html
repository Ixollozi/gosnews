<!DOCTYPE html>
{% load i18n %}
{% load static %}
<html lang="{{ LANGUAGE_CODE }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% trans "Barcha yangiliklar" %} - {% trans "Kambag'allikni qisqartirish" %}</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}?v={% now 'U' %}">
    <link rel="stylesheet" href="{% static 'css/news_detail.css' %}?v={% now 'U' %}">
    <link rel="stylesheet" href="{% static 'css/all_news.css' %}?v={% now 'U' %}">
</head>
<body>
{% csrf_token %}
<!-- Header -->
<header class="header">
    <div class="logo">
        <a href="{% url 'home' %}"><img src="{% static 'images/logo.svg' %}" alt="logo"></a>
    </div>

    <!-- Desktop Navigation -->
    <nav class="navbar" id="navbar">
        <a href="{% url 'home' %}" data-page="bosh-sahifa">{% trans "Bosh sahifa" %}</a>
        <div class="dropdown" id="dropdown-jangarma">
            <span>{% trans "Jang'arma" %}</span>
            <i class="arrow-down"></i>
            <div class="dropdown-menu">
                <a href="#footer">{% trans "Biz haqimizda" %}</a>
                <a href="leaders">{% trans "Rahbariyat" %}</a>
                <a href="guide/loan">{% trans "Suddan" %}</a>
                <a href="guide/subsidy">{% trans "Subsidiya" %}</a>
                <a href="guide/grant">{% trans "Grantlar" %}</a>
            </div>
        </div>
        <a href="#ariza" data-page="ariza">{% trans "Ariza qoldirish" %}</a>
        <a href="{% url 'all_news' %}" data-page="yangiliklar" class="active">{% trans "Yangiliklar" %}</a>
        <a href="#hududlar" data-page="hududlar">{% trans "Hududlar" %}</a>
        <a href="#mahalla" data-page="mahalla">{% trans "online.mahalla" %}</a>
    </nav>

    <!-- Header Right Section -->
    <div class="header-right">
        <div class="hamburger" id="hamburger">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <!-- Language selector -->
        <div class="language-selector" id="language-selector">
            <img src="{% static 'images/global-icon.svg' %}" alt="world-icon">
            <span id="current-language">{% get_language_info for LANGUAGE_CODE as lang %}{{ lang.code|upper|slice:":3" }}</span>
            <i class="arrow-down"></i>
            <div class="language-menu">
                <a href="#" data-lang="uz" onclick="changeLanguage('uz'); return false;">{% trans "O'zbek" %}</a>
                <a href="#" data-lang="ru" onclick="changeLanguage('ru'); return false;">{% trans "Русский" %}</a>
                <a href="#" data-lang="kaa" onclick="changeLanguage('kaa'); return false;">{% trans "Karakalpak" %}</a>
            </div>
        </div>
        <div class="search">
            <button>
                <img src="{% static 'images/search-icon.svg' %}" alt="search-icon" class="search-icon">
                <span>{% trans "Qidiruv" %}</span>
            </button>
        </div>
    </div>

    <!-- Mobile Menu -->
    <nav class="mobile-menu" id="mobile-menu">
        <a href="{% url 'home' %}" data-page="bosh-sahifa">{% trans "Bosh sahifa" %}</a>
        <div class="mobile-dropdown">
            <div class="mobile-dropdown-header" id="mobile-dropdown-header">
                <span>{% trans "Jang'arma" %}</span>
                <i class="arrow-down"></i>
            </div>
            <div class="mobile-dropdown-content" id="mobile-dropdown-content">
                <a href="#">{% trans "Biz haqimizda" %}</a>
                <a href="leaders">{% trans "Rahbariyat" %}</a>
                <a href="guide/loan">{% trans "Suddan" %}</a>
                <a href="guide/subsidy">{% trans "Subsidiya" %}</a>
                <a href="guide/grant">{% trans "Grantlar" %}</a>
            </div>
        </div>
        <a href="#ariza" data-page="ariza">{% trans "Ariza qoldirish" %}</a>
        <a href="{% url 'all_news' %}" data-page="yangiliklar" class="active">{% trans "Yangiliklar" %}</a>
        <a href="#hududlar" data-page="hududlar">{% trans "Hududlar" %}</a>
        <a href="#mahalla" data-page="mahalla">{% trans "online.mahalla" %}</a>
    </nav>
</header>

<div class="breadcrumb">
    <a href="{% url 'home' %}">{% trans "Bosh sahifa" %}</a>
    <span>></span>
    <span>{% trans "Yangiliklar" %}</span>
</div>

<!-- Main Content -->
<main class="main-content">
    <!-- Breadcrumb -->
    

    <!-- Main Content Layout -->
    <div class="content-layout">
        <!-- Sidebar with Categories -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h3>{% trans "Kategoriyalar" %}</h3>
            </div>
            <div class="category-list">
                <a href="{% url 'all_news' %}" class="category-item {% if not current_category %}active{% endif %}">
                    {% trans "Barchasi" %}
                </a>
                {% for category in categories %}
                <a href="?category={{ category.category.slug }}{% if search_query %}&search={{ search_query }}{% endif %}" 
                   class="category-item {% if current_category == category.category.slug %}active{% endif %}">
                    {{ category.name }}
                </a>
                {% endfor %}
            </div>
        </aside>

        <!-- Main Content Area -->
        <div class="main-content-area">
            <!-- Results Info -->
            <div class="results-info">
                {% if news_list %}
                    {% if search_query or current_category %}
                        {% trans "Natijalar" %}: {{ paginator.count }} {% trans "ta yangilik" %}
                        {% if search_query %}({% trans "qidiruv" %}: "{{ search_query }}"){% endif %}
                        {% if current_category %}({% trans "kategoriya" %}: {{ current_category }}){% endif %}
                    {% else %}
                        {% trans "Jami" %}: {{ paginator.count }} {% trans "ta yangilik" %}
                    {% endif %}
                    {% if paginator.num_pages > 1 %}
                        <br>
                        {% trans "Sahifa" %} {{ news_list.number }} {% trans "dan" }} {{ paginator.num_pages }}
                    {% endif %}
                {% endif %}
            </div>

            <!-- News Grid -->
            <div class="news-grid">
                {% for news_item in news_list %}
                <a class="news-card" href="{% url 'news_detail' news_id=news_item.news.id %}">
                    <img src="{{ news_item.image.url }}" alt="{{ news_item.title }}" class="news-card-image">
                    <div class="news-card-content">
                        <h3 class="news-card-title">{{ news_item.title }}</h3>
                        <p class="news-card-description">{{ news_item.short_description }}</p>
                        <div class="news-card-meta">
                            {% if news_item.category %}
                                <span class="news-category">{{ news_item.category.name }}</span>
                            {% endif %}
                            <span class="news-date">{{ news_item.news.created_at|date:"d M, H:i" }}</span>
                        </div>
                    </div>
                </a>
                {% empty %}
                <div class="no-news">
                    <h3>{% trans "Yangiliklar topilmadi" %}</h3>
                    <p>
                        {% if search_query %}
                            {% trans "Qidiruv natijalarida hech qanday yangilik topilmadi." %}
                        {% elif current_category %}
                            {% trans "Bu kategoriyada hali yangiliklar yo'q." %}
                        {% else %}
                            {% trans "Hali hech qanday yangilik qo'shilmagan." %}
                        {% endif %}
                    </p>
                    <a href="{% url 'home' %}" class="back-to-home">{% trans "Bosh sahifaga qaytish" %}</a>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Pagination -->
    {% if paginator.num_pages > 1 %}
    <div class="pagination">
        {% if news_list.has_previous %}
            <a href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}{% if current_category %}&category={{ current_category }}{% endif %}">
                {% trans "Birinchi" %}
            </a>
            <a href="?page={{ news_list.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if current_category %}&category={{ current_category }}{% endif %}">
                {% trans "Oldingi" %}
            </a>
        {% endif %}

        {% for num in news_list.paginator.page_range %}
            {% if news_list.number == num %}
                <span class="current">{{ num }}</span>
            {% elif num > news_list.number|add:'-3' and num < news_list.number|add:'3' %}
                <a href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}{% if current_category %}&category={{ current_category }}{% endif %}">
                    {{ num }}
                </a>
            {% endif %}
        {% endfor %}

        {% if news_list.has_next %}
            <a href="?page={{ news_list.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if current_category %}&category={{ current_category }}{% endif %}">
                {% trans "Keyingi" %}
            </a>
            <a href="?page={{ news_list.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}{% if current_category %}&category={{ current_category }}{% endif %}">
                {% trans "Oxirgi" %}
            </a>
        {% endif %}
    </div>
    {% endif %}
</main>

<script>
    // CSRF token function
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    // Language change function
    function changeLanguage(lang) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '/i18n/setlang/';
        const csrfInput = document.createElement('input');
        csrfInput.type = 'hidden';
        csrfInput.name = 'csrfmiddlewaretoken';
        csrfInput.value = getCookie('csrftoken');
        form.appendChild(csrfInput);
        const langInput = document.createElement('input');
        langInput.type = 'hidden';
        langInput.name = 'language';
        langInput.value = lang;
        form.appendChild(langInput);
        const nextInput = document.createElement('input');
        nextInput.type = 'hidden';
        nextInput.name = 'next';
        nextInput.value = window.location.pathname + window.location.search;
        form.appendChild(nextInput);
        document.body.appendChild(form);
        form.submit();
    }

    // Hamburger menu toggle
    const hamburger = document.getElementById('hamburger');
    const mobileMenu = document.getElementById('mobile-menu');
    hamburger.addEventListener('click', function(e) {
        e.stopPropagation();
        hamburger.classList.toggle('active');
        mobileMenu.classList.toggle('active');
    });

    // Language selector dropdown toggle
    const languageSelector = document.getElementById('language-selector');
    languageSelector.addEventListener('click', function(e) {
        e.stopPropagation();
        if (window.innerWidth <= 768) {
            this.classList.toggle('open');
            const arrow = this.querySelector('.arrow-down');
            arrow.style.transform = this.classList.contains('open') ? 'rotate(180deg)' : 'rotate(0deg)';
        }
    });

    // Mobile dropdown for Jang'arma
    const mobileDropdownHeader = document.getElementById('mobile-dropdown-header');
    const mobileDropdownContent = document.getElementById('mobile-dropdown-content');
    mobileDropdownHeader.addEventListener('click', function(e) {
        e.stopPropagation();
        mobileDropdownContent.classList.toggle('active');
        this.classList.toggle('open');
    });

    // Close menus on outside click
    document.addEventListener('click', function(e) {
        if (!hamburger.contains(e.target) && !mobileMenu.contains(e.target)) {
            hamburger.classList.remove('active');
            mobileMenu.classList.remove('active');
        }
        if (!languageSelector.contains(e.target)) {
            languageSelector.classList.remove('open');
            const arrow = languageSelector.querySelector('.arrow-down');
            if (arrow) arrow.style.transform = 'rotate(0deg)';
        }
    });

    // Close mobile menu on link click
    document.querySelectorAll('.mobile-menu a, .mobile-dropdown-content a').forEach(link => {
        link.addEventListener('click', function() {
            hamburger.classList.remove('active');
            mobileMenu.classList.remove('active');
            mobileDropdownContent.classList.remove('active');
            mobileDropdownHeader.classList.remove('open');
        });
    });
</script>
</body>
</html>
